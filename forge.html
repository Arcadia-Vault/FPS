<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FPS5 Multiplayer</title>
    <style>
      html, body {
        font-family: Arial, Helvetica, sans-serif;
        font-size: 20px;
        overflow: hidden !important;
        user-select: none !important;
        transition: top .2s;
        background: #eeeeee;
      }
      * {
        cursor: url(./cursors/cursor1.png), auto !important;
      }
      .sidebar {
        position: absolute;
        width: 300px;
        height: 400px;
        padding: 0;
        margin: 0;
        background: #fff;
        left: 100%;
        margin-left: -300px;
        bottom: 200px;
        border-top-left-radius: 5px;
        border-bottom-left-radius: 5px;
      }
    </style>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  </head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-2ZQ6TMGVXJ"></script>
  <script>
    window.dataLayer=window.dataLayer||[];
    function gtag(){dataLayer.push(arguments);}
    gtag("js", new Date());
    gtag("config", "G-2ZQ6TMGVXJ");
  </script>
  <body style="margin:0!important;">
    <div class="pause-menu" style="display:none">
      <h1 style="color:#25750a;font-weight:bold;font-family:monospace;position:absolute;left:20px;top:20px;font-size:75px;margin:0">PAUSED</h1>
      <div class="pause-tab" onclick="unpause()">Continue</div><br>
      <div class="pause-tab" onclick="confirm('Are you sure? All player will be disconnected.')&&cancelSearch()">Leave game</div><br>
      <div class="pause-tab" onclick="openSettings()">Settings</div><br>
    </div>
    <audio id="grenade_explosion" src="sounds/grenade_explosion.mp3" volume="1" current-time=".1"></audio>
    <audio id="ambience" src="sounds/ambience.mp3" autoplay loop volume="1"></audio>
    <audio id="click" src="sounds/click.mp3"></audio>
    <script src="https://threejs.org/build/three.min.js"></script>
    <script src="https://threejs.org/examples/js/loaders/OBJLoader.js"></script>
    <script src="https://threejs.org/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/mrdoob/three.js/examples/js/libs/fflate.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/alvaromontoro/gamecontroller.js@latest/dist/gamecontroller.min.js"></script>
    <div class="sidebar">
      <button onclick="add()">Add</button>
      <div id="objectRotation">
        <span id="x">0</span>, <span id="y">0</span>, <span id="z">0</span>
      </div>
      <br>
      <div id="objectPosition">
        <span id="x">0</span>, <span id="y">0</span>, <span id="z">0</span>
      </div>
      <label for="preferredRotation">Preferred Rotation</label><br>
      <input name="preferredRotation" id="preferredRotation" value="0, 0, 0" onkeydown="this.onkeyup()" onkeyup="currentItem&&(currentItem.preferredRotation.x=this.value.split(',')[0]-0,currentItem.preferredRotation.y=this.value.split(',')[1]-0,currentItem.preferredRotation.z=this.value.split(',')[2]-0)">
      <br>
      <i>Drop: [ESC]</i>
    </div>
    <script>
      const scene = new THREE.Scene();
      const camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),renderer=new THREE.WebGLRenderer({antialias:true});renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(renderer.domElement),renderer.setPixelRatio(1);
      function isTouchDevice(){return!!window.matchMedia("(pointer: coarse)").matches}
      isTouchDevice()?(()=>{const{Euler:e,EventDispatcher:t,Vector3:n}=THREE;var o;o=!1;var i=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),c=document.body.clientWidth/2,r=(document.body.clientHeight,window.innerHeight),s=function(t,s){o=!!i,void 0===s&&(console.warn('THREE.PointerLockControls: The second parameter "domElement" is now mandatory.'),s=document.body),this.domElement=s,this.isLocked=!1;var m,u,d,a=this,h={type:"change"},v={type:"lock"},l={type:"unlock"},E=new e(0,0,0,"YXZ"),p=Math.PI/2,k=Math.PI/3.8,L=Math.PI/9,f=new n,y=0,M=0;function x(){}function P(e){u=e.touches[0].clientY,m=e.touches[0].clientX,y=m-c,M=u-(r-100),E.setFromQuaternion(t.quaternion),E.y=.005*y,E.x=.005*M,E.x=Math.max(-p,Math.min(L,E.x)),E.y=Math.max(-k,Math.min(k,E.y)),t.quaternion.setFromEuler(E),a.dispatchEvent(h),console.log(M)}function w(e){}function g(e){if(!1!==a.isLocked){var n=e.movementX||e.mozMovementX||e.webkitMovementX||0,o=e.movementY||e.mozMovementY||e.webkitMovementY||0;E.setFromQuaternion(t.quaternion),E.y-=.002*n,E.x-=.002*o,E.x=Math.max(-p,Math.min(p,E.x)),E.y=Math.max(-k,Math.min(k,E.y)),t.quaternion.setFromEuler(E),a.dispatchEvent(h)}}function b(){document.pointerLockElement===a.domElement?(a.dispatchEvent(v),a.isLocked=!0):(a.dispatchEvent(l),a.isLocked=!1)}function F(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}this.connect=function(){document.addEventListener("mousemove",g,!1),document.addEventListener("touchstart",x,!1),document.addEventListener("touchmove",P,!1),document.addEventListener("pointerlockchange",b,!1),document.addEventListener("pointerlockerror",F,!1)},this.disconnect=function(){document.removeEventListener("mousemove",g,!1),document.removeEventListener("touchend",w,!1),document.removeEventListener("touchmove",onTouchmove,!1),document.removeEventListener("pointerlockchange",b,!1),document.removeEventListener("pointerlockerror",F,!1)},this.dispose=function(){this.disconnect()},this.getObject=function(){return t},this.getDirection=(d=new n(0,0,-1),function(e){return e.copy(d).applyQuaternion(t.quaternion)}),this.moveForward=function(e){f.setFromMatrixColumn(t.matrix,0),f.crossVectors(t.up,f),t.position.addScaledVector(f,e)},this.moveRight=function(e){f.setFromMatrixColumn(t.matrix,0),t.position.addScaledVector(f,e)},this.lock=1==o?function(){a.isLocked=!0,this.connect()}:function(){this.domElement.requestPointerLock()},this.unlock=function(){document.exitPointerLock()},this.connect()};(s.prototype=Object.create(t.prototype)).constructor=s,window.PointerLockControls=s})():(()=>{const _euler=new THREE.Euler(0,0,0,"YXZ"),_vector=new THREE.Vector3,_changeEvent={type:"change"},_lockEvent={type:"lock"},_unlockEvent={type:"unlock"},_PI_2=Math.PI/2;class PointerLockControls extends THREE.EventDispatcher{constructor(e,t){super(),void 0===t&&(console.warn('THREE.PointerLockControls: The second parameter "domElement" is now mandatory.'),t=document.body),this.domElement=t,this.isLocked=!1,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1;const o=this;function n(t){if(!1===o.isLocked)return;const n=t.movementX||t.mozMovementX||t.webkitMovementX||0,r=t.movementY||t.mozMovementY||t.webkitMovementY||0;_euler.setFromQuaternion(e.quaternion),_euler.y-=.002*n*o.pointerSpeed,_euler.x-=.002*r*o.pointerSpeed,_euler.x=Math.max(_PI_2-o.maxPolarAngle,Math.min(_PI_2-o.minPolarAngle,_euler.x)),e.quaternion.setFromEuler(_euler),o.dispatchEvent(_changeEvent)}function r(){o.domElement.ownerDocument.pointerLockElement===o.domElement?(o.dispatchEvent(_lockEvent),o.isLocked=!0):(o.dispatchEvent(_unlockEvent),o.isLocked=!1)}function c(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}this.connect=function(){o.domElement.ownerDocument.addEventListener("mousemove",n),o.domElement.ownerDocument.addEventListener("pointerlockchange",r),o.domElement.ownerDocument.addEventListener("pointerlockerror",c)},this.disconnect=function(){o.domElement.ownerDocument.removeEventListener("mousemove",n),o.domElement.ownerDocument.removeEventListener("pointerlockchange",r),o.domElement.ownerDocument.removeEventListener("pointerlockerror",c)},this.dispose=function(){this.disconnect()},this.getObject=function(){return e},this.getDirection=function(){const t=new THREE.Vector3(0,0,-1);return function(o){return o.copy(t).applyQuaternion(e.quaternion)}}(),this.moveForward=function(t){_vector.setFromMatrixColumn(e.matrix,0),_vector.crossVectors(e.up,_vector),e.position.addScaledVector(_vector,t)},this.moveRight=function(t){_vector.setFromMatrixColumn(e.matrix,0),e.position.addScaledVector(_vector,t)},this.lock=function(){this.domElement.requestPointerLock()},this.unlock=function(){o.domElement.ownerDocument.exitPointerLock()},this.connect()}}window.PointerLockControls=PointerLockControls})();
      scene.add(camera);
      map = new THREE.Mesh();
      light=new THREE.PointLight(0xf7f7ea,2),light.position.set(-10,20,-10),scene.add(light);
      sky=new THREE.Mesh(new THREE.SphereGeometry(100,100,100),new THREE.MeshBasicMaterial({color:0xffffff,map:(new THREE.TextureLoader).load("images/clouds3.png"),side:THREE.DoubleSide}));
      scene.add(sky);
      isWalkingForward = false;
      isWalkingBackward = false;
      isWalkingLeft = false;
      isWalkingRight = false;
      setInterval(() => {
        if (isWalkingForward) {
          camera.translateZ(-.1);
        }
        if (isWalkingBackward) {
          camera.translateZ(.1);
        }
        if (isWalkingLeft) {
          camera.translateX(-.1);
        }
        if (isWalkingRight) {
          camera.translateX(.1);
        }
      });
      document.addEventListener("keydown", (e) => {
        e.key == "Escape" && (currentItem = null);
        if (e.key == "ArrowUp") {
          isWalkingForward = true;
        }
        if (e.key == "ArrowDown") {
          isWalkingBackward = true;
        }
        if (e.key == "ArrowLeft") {
          isWalkingLeft = true;
        }
        if (e.key == "ArrowRight") {
          isWalkingRight = true;
        }
      });
      document.addEventListener("keyup", (e) => {
        if (e.key == "ArrowUp") {
          isWalkingForward = false;
        }
        if (e.key == "ArrowDown") {
          isWalkingBackward = false;
        }
        if (e.key == "ArrowLeft") {
          isWalkingLeft = false;
        }
        if (e.key == "ArrowRight") {
          isWalkingRight = false;
        }
      });
      currentItem = null;
      function animate() {
        renderer.render(scene, camera);
        if (currentItem) {
          currentItem.position.copy(camera.position);
          currentItem.rotation.copy(camera.rotation);
          currentItem.updateMatrix();
          currentItem.translateZ(-2);
          currentItem.rotateX(Math.PI/2+currentItem.preferredRotation.x);
          currentItem.rotateY(currentItem.preferredRotation.y);
          currentItem.rotateZ(currentItem.preferredRotation.z);
          document.querySelector("#objectRotation").querySelector("#x").textContent=currentItem.rotation.x;
          document.querySelector("#objectRotation").querySelector("#y").textContent=currentItem.rotation.y;
          document.querySelector("#objectRotation").querySelector("#z").textContent=currentItem.rotation.z;
          document.querySelector("#objectPosition").querySelector("#x").textContent=currentItem.position.x;
          document.querySelector("#objectPosition").querySelector("#y").textContent=currentItem.position.y;
          document.querySelector("#objectPosition").querySelector("#z").textContent=currentItem.position.z;
        }
        requestAnimationFrame(animate);
      }
      animate();
      controls=new PointerLockControls(camera, renderer.domElement);
      controls.isLocked=true;
      controls.pointerSpeed=2;
      function add() {
        let object = new THREE.Mesh();
        let map, color = "#ffffff", geometry, finalGeometry;
        window.dataURL = function(files) {
          let file = files[0];
          let reader = new FileReader();
          reader.addEventListener("load", () => {
            fetch(reader.result).then(function(response){return(response.blob())}).then(function(blob){
              map = new THREE.TextureLoader().load(URL.createObjectURL(blob));
            });
          }, false);
          if (file) {
            reader.readAsDataURL(file);
          }
        }
        window.changeColor = function(value) {
          color = value;
        }
        window.changeGeometry = function(value) {
          console.log(value);
          geometry = value == "Cube" ? THREE.BoxGeometry : value == "Sphere" ? THREE.SphereGeometry : value == "Cylinder" && THREE.CylinderGeometry;
        }
        window.changeSize = function(value) {
          value = value.split(",");
          console.log(value[0]-0,value[1]-0,value[2]-0)
          finalGeometry = new geometry(value[0]-0,value[1]-0,value[2]-0);
        }
        changeGeometry("Cube");
        changeSize("1, 1, 1");
        let e = document.createElement("div");
        e.innerHTML = `
        <h1>Geometry</h1>
        <label for="shape">Shape:</label>
        <select value="Cube" name="shape" onchange="changeGeometry(this.value)">
          <option value="Cube">Cube</option>
          <option value="Sphere">Sphere</option>
          <option value="Cylinder">Cylinder</option>
        </select>
        <br>
        <h1>Material</h1>
        <label for="color">Color:</label>
        <input name="color" value="#FFFFFF" type="color" onchange="changeColor(this.value)">
        <br>
        <label for="file">Texture:</label>
        <input name="file" type="file" accept=".jpg,.jpeg,.png" onchange="dataURL(this.files)">
        <br>
        <h1>Size</h1>
        <label for="size">Scale:</label>
        <input name="size" value="1, 1, 1" type="text" onchange="changeSize(this.value)">
        `;
        swal({
          content: e,
          button: "Add Object"
        }).then(() => {
          if (map) {
            object.material.map = map;
          }
          object.geometry = finalGeometry;
          object.material.color.r = new THREE.Color(color).r;
          object.material.color.g = new THREE.Color(color).g;
          object.material.color.b = new THREE.Color(color).b;
          scene.add(object);
          object.preferredRotation = {};
          object.preferredRotation.x = 0;
          object.preferredRotation.y = 0;
          object.preferredRotation.z = 0;
          currentItem = object;
        });
      }
    </script>
  </body>
</html>